<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Żeglarskie Fiszki</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="card">
    <h2 id="question">Loading question…</h2>

    <ul id="answers" class="answers"></ul>

    <p id="result" class="result"></p>

    <div class="buttons">
      <button id="checkBtn">Check</button>
      <button id="nextBtn">Next</button>
    </div>
  </main>

  <script>
    // ---------- data / state ----------
    let allQuestions = [];
    let current = null;

    function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    }

    // ---------- helpers ----------
    function pickRandom() {
      const i = Math.floor(Math.random() * allQuestions.length);
      return allQuestions[i];
    }

    function renderQuestion(q) {
      document.getElementById("question").textContent = q.question;
      document.getElementById("result").textContent = "";
      const ul = document.getElementById("answers");
      ul.innerHTML = "";

      const keys = ["answer_1", "answer_2", "answer_3"];
      shuffle(keys);                            // random order each render

       keys.forEach((key) => {
      const li = document.createElement("li");
      const val = Number(key.slice(-1));      // 1, 2, or 3 → keeps correct-answer logic intact
      li.innerHTML = `
      <label>
        <input type="radio" name="answer" value="${val}">
        <span>${q[key]}</span>
      </label>`;
      ul.appendChild(li);
      });
    }

    function colorAnswers(selected) {
      const inputs = document.querySelectorAll('input[name="answer"]');
      inputs.forEach((inp) => {
        const li = inp.parentElement.parentElement;
        const ansIndex = Number(inp.value);
        li.classList.remove("correct", "incorrect");
        if (ansIndex === current.correct_answer) {
          li.classList.add("correct");
        } else if (ansIndex === selected) {
          li.classList.add("incorrect");
        }
      });
    }

    // ---------- event handlers ----------
    document.getElementById("checkBtn").addEventListener("click", () => {
      const checked = document.querySelector('input[name="answer"]:checked');
      if (!checked) return;            // nothing picked – ignore
      const chosen = Number(checked.value);
      colorAnswers(chosen);

      const res = document.getElementById("result");
      res.textContent = chosen === current.correct_answer ? "CORRECT ✅" : "WRONG ❌";
    });

    document.getElementById("nextBtn").addEventListener("click", () => {
      const nextQ = pickRandom();
      current = nextQ;
      renderQuestion(nextQ);
    });

    // ---------- initialise ----------
    fetch("questions.json")
      .then((r) => r.json())
      .then((data) => {
        allQuestions = data;
        current = pickRandom();
        renderQuestion(current);

        document.getElementById("answers").addEventListener("click", (e) => {
        const li = e.target.closest("li");
        if (!li) return;                       // clicked outside any option
        li.querySelector('input[type="radio"]').checked = true;
        });
      })
      .catch((err) => {
        document.getElementById("question").textContent =
          "Failed to load questions.json";
        console.error(err);
      });
  </script>
</body>
</html>
